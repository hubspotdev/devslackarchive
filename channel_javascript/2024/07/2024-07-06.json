[
  {
    "poster": {
      "poster_name": "Lari",
      "poster_handle": "laricsmartins"
    },
    "time_stamp": "2024-07-06 09:48:52",
    "text": "Hello guys, I am working on a module that should display a video but when the user clicks to play the video for the first time, it should popup a form that after submitted, the video can be played.\n\nI’m using cookies to check if the video can be played or it has to show the form first.\n\nCurrently the code is like this… It worked once but now isn’t working anymore… Could you help me to see what’s wrong? Thanks a lot\n\n```{# Defining the intern name of the module #}\n{% set module_slug = \"post-video\" %}\n\n{# The module code starts here #}\n{% if module.isActive %}\n&lt;div id=\"{{ module_slug }}\" class=\"module\"&gt;\n  &lt;div class=\"{{ module_slug }}-wrapper\" style=\"position: relative;\"&gt;\n    {% if module.video_file.player_id %}\n    &lt;div id=\"video-container\"&gt;\n        {% video_player \"embed_player\" player_id={{ module.video_file.player_id }} type={{ module.video_file.player_type || 'scriptV4' }} full_width={{ module.video_file.size_type == 'auto_full_width' }} conversion_asset={{ module.video_file.conversion_asset|tojson|safe }} autoplay={{ module.video_file.autoplay }} hidden_controls={{ module.video_file.hide_controls }} loop={{ module.video_file.loop_video }} muted={{ module.video_file.mute_by_default }} %}\n    &lt;/div&gt;\n    {% endif %}\n  &lt;/div&gt;\n  &lt;div class=\"{{ module_slug }}-form\" style=\"display: none;\"&gt;\n    &lt;div id=\"form-modal\"&gt;\n      {% form form_to_use=\"{{ module.lead_form.form_id }}\" response_response_type=\"{{ module.lead_form.response_type }}\" response_message=\"{{ module.lead_form.message }}\" response_redirect_id=\"{{ module.lead_form.redirect_id }}\" response_redirect_url=\"{{module.lead_form.redirect_url}}\" gotowebinar_webinar_key=\"{{ module.lead_form.gotowebinar_webinar_key }}\" %}\n    &lt;/div&gt;\n  &lt;/div&gt;\n&lt;/div&gt;```\n```document.addEventListener('DOMContentLoaded', function() {\n  // Variables\n  const form = document.querySelector('.post-video-form');\n  const videoContainer = document.getElementById('video-container');\n\n  // Function to set a cookie\n  function setCookie(name, value, days) {\n    var expires = '';\n    if (days) {\n      var date = new Date();\n      date.setTime(date.getTime() + days * 24 * 60 * 60 * 1000);\n      expires = '; expires=' + date.toUTCString();\n    }\n    document.cookie = name + '=' + (value || '') + expires + '; path=/';\n  }\n\n  // Function to get a cookie\n  function getCookie(name) {\n    var nameEQ = name + '=';\n    var ca = document.cookie.split(';');\n    for (var i = 0; i &lt; ca.length; i++) {\n      var c = ca[i];\n      while (c.charAt(0) == ' ') c = c.substring(1, c.length);\n      if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);\n    }\n    return null;\n  }\n\n  // Function to check if the form has been filled\n  function checkFormFilled() {\n    return getCookie('formFilled') !== null;\n  }\n\n  // Function to show the form\n  function showForm() {\n    form.style.display = 'block';\n  }\n\n  // Function to hide the form\n  function hideForm() {\n    form.style.display = 'none';\n  }\n\n  // Function to enable the video\n  function enableVideo() {\n    const videoPlayer = videoContainer.querySelector('video');\n    if (videoPlayer) {\n      videoPlayer.play();\n    }\n  }\n\n  // Function to handle form submission\n  function handleFormSubmission(event) {\n    event.preventDefault();\n    setCookie('formFilled', 'true', 365);\n    // Refresh the page after setting the cookie\n    window.location.reload();\n  }\n\n  // Main function to handle video click\n  function handleVideoClick() {\n    if (!checkFormFilled()) {\n      showForm();\n    } else {\n      enableVideo();\n    }\n  }\n\n  // Event listener for video click\n  videoContainer.addEventListener('click', handleVideoClick);\n\n  // Event listener for form submission\n  form.querySelector('form').addEventListener('submit', handleFormSubmission);\n\n  // On page load, check if the form is filled\n  window.onload = function() {\n    if (checkFormFilled()) {\n      enableVideo();\n    } else {\n      showForm();\n    }\n  };\n});```\n"
  }
]