[
  {
    "poster": {
      "poster_name": "Andrei Axinoi",
      "poster_handle": "andreiaxinoi"
    },
    "time_stamp": "2024-07-12 15:47:07",
    "text": "Hi everyone,\nI've developed a custom HubSpot module to display a popup modal with a form that acts as a gate for a page. Once the form is submitted, the modal disappears, and a cookie is set in the user's browser so they won't have to fill out the form again.\n\nThe only way I could make it work is with the help of the new `MutationObserver()`. I just want to check if there is a simpler way to attach an event listener to the form's \"onSubmit\" event since the following code did not work:\n\n```const form = document.querySelector('#form-modal form');\nform.addEventListener('submit', handleFormSubmission);```\nWorking Version :\n```\n  &lt;script src=\"<https://cdn.jsdelivr.net/npm/js-cookie@3.0.5/dist/js.cookie.min.js>\"&gt;&lt;/script&gt;\n  &lt;style&gt;\n    /* Basic styles for the modal form and overlay */\n    #form-modal {\n      display: none; /* Hidden by default */\n      position: fixed;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      background-color: white;\n      padding: 20px;\n      box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);\n      z-index: 1000;\n    }\n    #form-overlay {\n      display: none;\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background-color: rgba(0, 0, 0, 0.5);\n      z-index: 999;\n    }\n   \n    .background-text {\n      font-size: 24px;\n      color: #ccc;\n      text-align: center;\n      padding: 50px;\n    }\n  &lt;/style&gt;\n\n  &lt;div class=\"background-text\"&gt;\n    &lt;p&gt;Welcome to our website! Please fill out the form to continue.&lt;/p&gt;\n  &lt;/div&gt;\n  \n  &lt;div id=\"form-overlay\"&gt;&lt;/div&gt;\n  &lt;div id=\"form-modal\"&gt;\n    {% form\n      form_to_use=\"{{ module.form_field.form_id }}\"\n      response_response_type=\"{{ module.form_field.response_type }}\"\n      response_message=\"{{ module.form_field.message }}\"\n      response_redirect_id=\"{{ module.form_field.redirect_id }}\"\n      response_redirect_url=\"{{ module.form_field.redirect_url }}\"\n      gotowebinar_webinar_key=\"{{ module.form_field.gotowebinar_webinar_key }}\"\n    %}\n  &lt;/div&gt;\n\n  &lt;script type=\"text/javascript\"&gt;\n    document.addEventListener('DOMContentLoaded', function() {\n      // Function to show the form modal\n      function showForm() {\n        console.log(\"Showing form modal\");\n        document.getElementById('form-modal').style.display = 'block';\n        document.getElementById('form-overlay').style.display = 'block';\n      }\n\n      // Function to hide the form modal\n      function hideForm() {\n        console.log(\"Hiding form modal\");\n        document.getElementById('form-modal').style.display = 'none';\n        document.getElementById('form-overlay').style.display = 'none';\n      }\n\n      // Function to check if the form has been filled\n      function checkFormFilled() {\n        const filled = Cookies.get('formFilled') !== undefined;\n        console.log('Check form filled:', filled, 'Cookie:', document.cookie);\n        return filled;\n      }\n\n      // Handle form submission\n      function handleFormSubmission(event) {\n        event.preventDefault();\n        console.log('Form submitted, setting cookie');\n        Cookies.set('formFilled', 'true', { expires: 365, path: '/' });\n        hideForm();\n      }\n\n      // Wait for the form to be available in the DOM and attach the submit event listener\n      const observer = new MutationObserver(function(mutations) {\n        mutations.forEach(function(mutation) {\n          if (mutation.addedNodes.length) {\n            const form = document.querySelector('#form-modal form');\n            if (form) {\n              form.addEventListener('submit', handleFormSubmission);\n              observer.disconnect(); // Stop observing after attaching the event\n            }\n          }\n        });\n      });\n\n      observer.observe(document.getElementById('form-modal'), { childList: true, subtree: true });\n\n      // On page load, check if the form is filled\n      if (!checkFormFilled()) {\n        showForm();\n      } else {\n        console.log('Form already filled, modal not shown.');\n      }\n    });\n  &lt;/script&gt;```",
    "reply_count": 1,
    "reply_users_count": 1,
    "replies": [
      {
        "time_stamp": "2024-07-13 21:09:33"
      }
    ]
  }
]